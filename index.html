<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
    content="Genera ideas impactantes para redes sociales con IA. Usa FeedFlow, una app creativa, profesional y visualmente atractiva." />
  <title>FeedFlow ‚Äì Ideas con IA</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <!-- CSS libs -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root {
      --ff-morado: #8e44ad;
      --ff-dorado: #f1c40f;
      --ff-fondo: #fdfdfd;
      --ff-degradado: linear-gradient(to right, #8e44ad, #f39c12);
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--ff-fondo);
      color: #333;
    }

    .ff-logo {
      font-size: 2rem;
      font-weight: bold;
      color: var(--ff-morado);
    }

    .ff-gradient {
      background: var(--ff-degradado);
      color: white;
    }

    .ff-section {
      padding: 2rem 1rem;
    }

    .is-hidden {
      display: none !important;
    }

    .ff-toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      min-width: 200px;
      z-index: 9999;
      opacity: 0.95;
    }
  </style>
</head>

<body>
  <!-- Vista de autenticaci√≥n -->
  <section id="ff-auth-view" class="ff-section">
    <div class="container">
      <h2 class="title is-4" id="title-results">Ideas generadas</h2>
      <div id="ff-results-container" class="mt-4"></div>
      <h1 class="title has-text-centered ff-logo">FeedFlow</h1>
      <p class="subtitle has-text-centered" id="auth-title">Inicia sesi√≥n para comenzar</p>
      <div class="box has-background-light mt-4">
        <label class="label" id="ff-label-language-app" for="ff-auth-language-selector">Idioma de la aplicaci√≥n</label>
        <div class="control">
          <div class="select is-fullwidth">
            <select id="ff-auth-language-selector" title="Idioma de la aplicaci√≥n">
              <option value="es">Espa√±ol</option>
              <option value="en">English</option>
              <option value="pt">Portugu√™s</option>
            </select>
          </div>
        </div>
        <p class="help mt-1">
          <em>Elige el idioma para la interfaz y las ideas generadas.</em><br>
          <em>Select the language for the interface and generated ideas.</em><br>
          <em>Escolha o idioma da interface e das ideias geradas.</em>
        </p>
      </div>
      <div class="buttons is-centered">
        <button id="ff-google-login" class="button is-light">
          <span class="icon"><i class="fab fa-google"></i></span>
          <span>Google</span>
        </button>
        <div id="ff-loading" class="notification is-warning is-light is-hidden animate__animated animate__fadeIn">
          <strong>Generando ideas...</strong> Por favor, espera un momento.
        </div>
      </div>
      <p id="toggle-auth-text" class="has-text-centered mt-4"></p>
    </div>
  </section>

  <!-- Vista de configuraci√≥n (generaci√≥n de ideas) -->
  <section id="ff-config-view" class="ff-section is-hidden">
    <div class="container">
      <div class="is-flex is-justify-content-flex-end">
        <button id="ff-logout-btn" class="button is-small is-danger">Cerrar sesi√≥n</button>
      </div>
      <h2 class="title" id="ff-title-config">Configura tu idea</h2>
      <div class="field">
        <label id="ff-label-generationmode" for="ff-mode-selector">¬øC√≥mo quieres generar las ideas?</label>
        <div class="control">
          <div class="select">
            <select id="ff-mode-selector">
              <option value="multired" data-key="opt-multired">Una idea por cada red social (Multired)</option>
              <option value="individual" data-key="opt-individual">Tres ideas para una sola red (Individual)</option>
            </select>
          </div>
        </div>
        <p class="help mt-1" id="ff-mode-help">Selecciona: 3 propuestas una red, o varias redes para una idea por cada
          una</p>
      </div>
      <div class="field">
        <label id="ff-label-keyword" for="ff-keyword">Tema o palabra clave</label>
        <div class="control"><input id="ff-keyword" class="input" type="text" required></div>
      </div>
      <div class="field mt-4">
        <label class="label" id="ff-label-copytype" for="ff-copytype">Tipo de publicaci√≥n</label>
        <div class="control">
          <div class="select is-fullwidth">
            <select id="ff-copytype" required></select>
          </div>
        </div>
        <p id="ff-copytype-description" class="help is-info mt-2 mb-4"></p>
      </div>
      <div class="field mt-4">
        <label class="label" id="ff-label-networks">Redes sociales</label>
        <p id="ff-help-networks" class="help mb-1">Selecciona una o m√°s redes sociales seg√∫n el modo elegido</p>
        <div class="control">
          <div class="buttons are-small is-flex is-flex-wrap-wrap" id="ff-networks-container"></div>
        </div>
        <div style="margin-bottom: 6rem;"></div>
        <div class="field">
          <button id="ff-generate-btn" class="button is-primary is-fullwidth">
            Generar ideas
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Vista resultados -->
  <section id="ff-results-view" class="section is-hidden">
    <div class="container">
      <h2 class="title" id="ff-title-results">Ideas generadas</h2>
      <div id="ff-results"></div>
      <button id="ff-back-to-config" class="button mt-4">Volver</button>
    </div>
  </section>

  <!-- Modal Feedback -->
  <div class="modal" id="ff-feedback-modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <div class="box">
        <p id="ff-feedback-question">¬øEsta idea te fue √∫til?</p>
        <div class="buttons is-centered mt-3">
          <button class="button is-success ff-feedback-btn" data-feedback="like"><i
              class="fas fa-thumbs-up"></i></button>
          <button class="button is-danger ff-feedback-btn" data-feedback="dislike"><i
              class="fas fa-thumbs-down"></i></button>
        </div>
      </div>
    </div>
    <button class="modal-close is-large" aria-label="close" id="ff-close-feedback"></button>
  </div>

  <!-- Admin Panel -->
  <section id="ff-admin-view" class="ff-section is-hidden">
    <div class="container">
      <h2 class="title" id="ff-title-admin">Control Admin ‚Äì Premium Global</h2>
      <div class="field">
        <label class="checkbox"><input type="checkbox" id="ff-toggle-premium-global"> Activar Premium Global</label>
      </div>
      <div class="field">
        <label class="label" id="ff-label-expiration">Fecha de expiraci√≥n</label>
        <div class="control"><input type="datetime-local" id="ff-premium-end-date" class="input"></div>
      </div>
      <button id="ff-set-premium-btn" class="button is-warning mt-2">Actualizar</button>
      <p id="ff-premium-status-text" class="mt-3"></p>
    </div>
  </section>

  <!-- Toast de notificaciones -->
  <div id="ff-toast" class="notification is-info ff-toast is-hidden"></div>

  <!-- Footer -->
  <footer class="footer has-text-centered mt-6">
    <p id="ff-footer-disclaimer" class="is-size-7">
      Aplicaci√≥n experimental para generaci√≥n de ideas en redes sociales. Desarrollado con üí° en Latinoam√©rica.
    </p>
    <p id="ff-footer-legal" class="is-size-7">
      FeedFlow no se hace responsable por los contenidos generados por inteligencia artificial.
    </p>
    <p id="ff-footer-copy" class="is-size-7 has-text-grey">
      Desarrollado por FeedFlow ¬∑ 2025
    </p>
  </footer>

  <!-- JS principal unificado -->
  <script type="module">
    // 1. --- Firebase Setup y referencias globales ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-functions.js";
    import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // 2. --- Configuraci√≥n y utilidades generales ---
    const firebaseConfig = {
      apiKey: "AIzaSyCScJA-UGs3WcBnfAm-6K94ybZ4bzBahz8",
      authDomain: "brain-storm-8f0d8.firebaseapp.com",
      projectId: "brain-storm-8f0d8",
      storageBucket: "brain-storm-8f0d8.appspot.com",
      messagingSenderId: "401208607043",
      appId: "1:401208607043:web:6f35fc81fdce7b3fbeaff6"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const functions = getFunctions(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // 3. --- Traducciones y helpers internacionales (puedes expandir) ---
<!-- üîß FF-BLOCK-3: ESTRUCTURA HTML -->
<section id="ff-auth-view" class="ff-section">
  <div class="container">
    <h2 class="title is-4" id="title-results">Ideas generadas</h2>
    <div id="ff-results-container" class="mt-4"></div>
    <h1 class="title has-text-centered ff-logo">FeedFlow</h1>
    <p class="subtitle has-text-centered" id="auth-title">Inicia sesi√≥n para comenzar</p>
    <div class="box has-background-light mt-4">
      <label class="label" id="ff-label-language-app">Idioma de la aplicaci√≥n</label>
      <div class="control">
        <div class="select is-fullwidth">
          <select id="ff-auth-language-selector"
            title="Elige el idioma para la interfaz y las ideas generadas. / Select the language for the interface and generated ideas. / Escolha o idioma da interface e das ideias geradas.">
            <option value="es">Espa√±ol</option>
            <option value="en">English</option>
            <option value="pt">Portugu√™s</option>
          </select>
        </div>
      </div>
      <p class="help mt-1">
        <em>Elige el idioma para la interfaz y las ideas generadas. </em><br>
        <em>Select the language for the interface and generated ideas.</em><br>
        <em>Escolha o idioma da interface e das ideias geradas.</em>
      </p>
    </div>

    <div class="buttons is-centered">
      <button id="ff-google-login" class="button is-light">
        <span class="icon"><i class="fab fa-google"></i></span>
        <span>Google</span>
      </button>
      <div id="ff-loading" class="notification is-warning is-light is-hidden animate__animated animate__fadeIn">
        <strong>Generando ideas...</strong> Por favor, espera un momento.
      </div>
    </div>

    <p id="toggle-auth-text" class="has-text-centered mt-4"></p>

  </div>
</section>

<!--Modo de generaci√≥n-- >
      <section id="ff-config-view" class="ff-section is-hidden">
        <div class="container">
          <div class="is-flex is-justify-content-flex-end">
            <button id="ff-logout-btn" class="button is-small is-danger">Cerrar sesi√≥n</button>
          </div>
          <h2 class="title" id="ff-title-config">Configura tu idea</h2>
          <div class="field">
            <label id="ff-label-generationmode">¬øC√≥mo quieres generar las ideas?</label>
            <div class="control">
              <div class="select">
                <select id="ff-mode-selector">
                  <option value="multired" data-key="opt-multired">Una idea por cada red social (Multired)</option>
                  <option value="individual" data-key="opt-individual">Tres ideas para una sola red (Individual)</option>
                </select>
              </div>
            </div>
            <p class="help mt-1" id="ff-mode-help">Selecciona: 3 propuestas una red, o varias redes para una idea por cada
              una</p>
          </div>

          <!-- Tipo de publicaci√≥n -->
          <div class="field">
            <label id="ff-label-keyword">Tema o palabra clave</label>
            <div class="control"><input id="ff-keyword" class="input" type="text"></div>
          </div>

          <div class="field mt-4">
            <label class="label" id="ff-label-copytype">Tipo de publicaci√≥n</label>
            <div class="control">
              <div class="select is-fullwidth">
                <select id="ff-copytype" required>
                  <option value="de beneficio y solucion" data-key="opt-de beneficio y solucion">De beneficio y soluci√≥n
                  </option>
                  <option value="de novedad o lanzamiento" data-key="opt-de novedad o lanzamiento">De novedad o lanzamiento
                  </option>
                  <option value="de interaccion o pregunta" data-key="opt-de interaccion o pregunta">De interacci√≥n o
                    pregunta</option>
                  <option value="de urgencia o escacez" data-key="opt-de urgencia o escacez">De urgencia o escasez</option>
                  <option value="informativo o educativo" data-key="opt-informativo o educativo">Informativo o educativo
                  </option>
                  <option value="informal" data-key="opt-informal">Informal</option>
                  <option value="llamada a la Acci√≥n (CTA)" data-key="opt-llamada a la Acci√≥n (CTA)">Llamada a la Acci√≥n
                    (CTA)</option>
                  <option value="narrativo o storytelling" data-key="opt-narrativo o storytelling">Narrativo o storytelling
                  </option>
                  <option value="posicionamiento o branding" data-key="opt-posicionamiento o branding">Posicionamiento o
                    branding</option>
                  <option value="testimonio o prueba" data-key="opt-testimonio o prueba social">Testimonio o prueba</option>
                  <option value="t√©cnico o profesional" data-key="opt-t√©cnico o profesional">T√©cnico o profesional</option>
                  <option value="venta directa o persuasivo" data-key="opt-venta directa o persuasivo">Venta directa o
                    persuasivo</option>
                </select>
              </div>
            </div>
            <p id="ff-copytype-description" class="help is-info mt-2 mb-4"></p>
          </div>

          <!-- Redes sociales -->
          <div class="field mt-4">
            <label class="label" id="ff-label-networks">Redes sociales</label>
            <p id="ff-help-networks" class="help mb-1">Selecciona una o m√°s redes sociales seg√∫n el modo elegido</p>
            <div class="control">
              <div class="buttons are-small is-flex is-flex-wrap-wrap" id="ff-networks-container">
                <label class="checkbox mr-3"><input type="checkbox" value="Facebook" class="ff-social"> Facebook</label>
                <label class="checkbox mr-3"><input type="checkbox" value="X / Twitter" class="ff-social"> X /
                  Twitter</label>
                <label class="checkbox mr-3"><input type="checkbox" value="LinkedIn" class="ff-social"> LinkedIn</label>
                <label class="checkbox mr-3"><input type="checkbox" value="WhatsApp" class="ff-social"> WhatsApp</label>
                <label class="checkbox mr-3"><input type="checkbox" value="Telegram" class="ff-social"> Telegram</label>
                <label class="checkbox mr-3"><input type="checkbox" value="Reddit" class="ff-social"> Reddit</label>
                <label class="checkbox mr-3"><input type="checkbox" value="Instagram" class="ff-social"> Instagram</label>
                <label class="checkbox mr-3"><input type="checkbox" value="TikTok" class="ff-social"> TikTok</label>
                <label class="checkbox"><input type="checkbox" value="YouTube" class="ff-social"> YouTube</label>
              </div>
            </div>

            <!-- Espacio para evitar solapamiento con bot√≥n fijo -->
            <div style="margin-bottom: 6rem;"></div>

            <!-- Bot√≥n flotante corregido -->
            <div class="field">
              <button id="ff-generate-btn" onclick="generateIdeas()" class="button is-primary is-fullwidth">
                Generar ideas
              </button>
            </div>
          </section>

    // 4. --- Toast de notificaciones amigables ---
          function showToast(msg, type = "is-info", timeout = 2000) {
      const toast = document.getElementById("ff-toast");
          toast.className = `notification ff-toast ${type}`;
          toast.textContent = msg;
          toast.classList.remove("is-hidden");
      setTimeout(() => {toast.classList.add("is-hidden"); }, timeout);
    }

          // 5. --- Opciones de copytype y redes sociales ---
          const copyTypeOptions = [
          {value: "de beneficio y solucion", key: "de beneficio y solucion" },
          {value: "de novedad o lanzamiento", key: "de novedad o lanzamiento" },
          {value: "de interaccion o pregunta", key: "de interaccion o pregunta" },
          {value: "de urgencia o escacez", key: "de urgencia o escacez" },
          {value: "informativo o educativo", key: "informativo o educativo" },
          {value: "informal", key: "informal" },
          {value: "llamada a la Acci√≥n (CTA)", key: "llamada a la Acci√≥n (CTA)" },
          {value: "narrativo o storytelling", key: "narrativo o storytelling" },
          {value: "posicionamiento o branding", key: "posicionamiento o branding" },
          {value: "testimonio o prueba", key: "testimonio o prueba" },
          {value: "t√©cnico o profesional", key: "t√©cnico o profesional" },
          {value: "venta directa o persuasivo", key: "venta directa o persuasivo" }
          ];
          const socialNetworksList = [
          "Facebook", "X / Twitter", "LinkedIn", "WhatsApp", "Telegram",
          "Reddit", "Instagram", "TikTok", "YouTube"
          ];

          // 6. --- Render din√°mico de selects y checkboxes ---
          function fillCopyTypeOptions() {
      const select = document.getElementById("ff-copytype");
          select.innerHTML = "";
      copyTypeOptions.forEach(opt => {
        const option = document.createElement("option");
          option.value = opt.value;
          option.textContent = opt.value;
          select.appendChild(option);
      });
    }
          function fillSocialCheckboxes() {
      const container = document.getElementById("ff-networks-container");
          container.innerHTML = "";
      socialNetworksList.forEach(network => {
        const label = document.createElement("label");
          label.className = "checkbox mr-3";
          const input = document.createElement("input");
          input.type = "checkbox";
          input.className = "ff-social";
          input.value = network;
          label.appendChild(input);
          label.appendChild(document.createTextNode(" " + network));
          container.appendChild(label);
      });
    }

          // 7. --- Restricciones de selecci√≥n de redes ---
          function setupNetworkRestrictions() {
      const modeSelector = document.getElementById("ff-mode-selector");
          const container = document.getElementById("ff-networks-container");
          function restrictNetworks() {
        const mode = modeSelector.value;
          const checkboxes = container.querySelectorAll("input.ff-social");
        checkboxes.forEach(cb => {
            cb.checked = false;
          cb.disabled = false;
        });
        checkboxes.forEach(cb => cb.replaceWith(cb.cloneNode(true))); // Limpia listeners previos
          if (mode === "individual") {
          const checkboxesNew = container.querySelectorAll("input.ff-social");
          checkboxesNew.forEach(cb => {
            cb.addEventListener("change", function () {
              if (this.checked) {
                checkboxesNew.forEach(other => {
                  if (other !== this) {
                    other.checked = false;
                    other.disabled = true;
                  }
                });
              } else {
                checkboxesNew.forEach(cb => cb.disabled = false);
              }
            });
          });
        }
      }
          modeSelector.addEventListener("change", restrictNetworks);
          restrictNetworks();
    }

          function updateCopyTypeDescription() {
      // ... puedes expandir para mostrar descripciones din√°micas seg√∫n idioma
      const value = document.getElementById("ff-copytype").value;
          const descEl = document.getElementById("ff-copytype-description");
          descEl.textContent = value; // Placeholder (puedes poner descripciones aqu√≠)
    }

    // 8. --- UI inicial y listeners generales ---
    document.addEventListener("DOMContentLoaded", () => {
            fillCopyTypeOptions();
          fillSocialCheckboxes();
          setupNetworkRestrictions();
          document.getElementById("ff-copytype").addEventListener("change", updateCopyTypeDescription);
          updateCopyTypeDescription();
    });

    // 9. --- Autenticaci√≥n y control de vistas ---
    document.getElementById("ff-google-login").addEventListener("click", async () => {
      try {
            await signInWithPopup(auth, provider);
      } catch (error) {
            showToast("Error al iniciar sesi√≥n. Intenta de nuevo.", "is-danger");
      }
    });
    document.getElementById("ff-logout-btn").addEventListener("click", async () => {
      try {
            await signOut(auth);
      } catch (error) {
            showToast("Error al cerrar sesi√≥n.", "is-danger");
      }
    });
    onAuthStateChanged(auth, (user) => {
            document.getElementById("ff-auth-view").classList.toggle("is-hidden", !!user);
          document.getElementById("ff-config-view").classList.toggle("is-hidden", !user);
          document.getElementById("ff-generate-btn").disabled = !user;
          document.getElementById("ff-admin-view").classList.add("is-hidden");
          if (user) validarAdmin(user.uid);
    });

    // 10. --- Generaci√≥n de ideas ---
    document.getElementById("ff-generate-btn").addEventListener("click", async () => {
      const user = auth.currentUser;
          const keyword = document.getElementById("ff-keyword").value.trim();
          const copytype = document.getElementById("ff-copytype").value;
          const language = localStorage.getItem("ff-lang") || "es";
          const mode = document.getElementById("ff-mode-selector").value;
          const networkCheckboxes = document.querySelectorAll(".ff-social:checked");
      const networks = Array.from(networkCheckboxes).map(el => el.value);
          if (!user || !keyword || !copytype || !mode || networks.length === 0) {
            showToast("Por favor, completa los campos requeridos.", "is-warning");
          return;
      }
          const container = document.getElementById("ff-results-container");
          container.innerHTML = `<div class="notification is-info">Generando ideas...</div>`;
          try {
        const generateIdeasFn = httpsCallable(functions, "generateIdeas");
          const response = await generateIdeasFn({keyword, copytype, language, networks, mode});
        if (response.data.success && response.data.ideas.length > 0) {
            container.innerHTML = "";
          response.data.ideas.forEach((idea, index) => {
            const card = document.createElement("div");
          card.className = "card mb-3 p-3";
          const content = document.createElement("div");
          content.className = "content";
          content.innerHTML = `<strong>Idea ${index + 1}:</strong> ${idea.text}`;
          const copyBtn = document.createElement("button");
          copyBtn.className = "button is-small is-success mt-2";
          copyBtn.textContent = "Copiar";
            copyBtn.onclick = () => {
            navigator.clipboard.writeText(idea.text);
          showToast("¬°Texto copiado!", "is-success");
            };
          card.appendChild(content);
          card.appendChild(copyBtn);
          container.appendChild(card);
          });
        } else {
            container.innerHTML = `<div class="notification is-warning">No se generaron ideas. Intenta con otra palabra clave.</div>`;
        }
      } catch (error) {
            console.error("Error al generar ideas:", error);
          container.innerHTML = `<div class="notification is-danger">Hubo un error al generar las ideas.</div>`;
      }
    });

    // 11. --- Feedback de ideas ---
    document.addEventListener("click", async (e) => {
      if (e.target.classList.contains("ff-feedback-btn")) {
            // Implementa l√≥gica de feedback aqu√≠
            showToast("¬°Gracias por tu opini√≥n!", "is-success");
      }
    });
    document.getElementById("ff-close-feedback").addEventListener("click", () => {
            document.getElementById("ff-feedback-modal").classList.remove("is-active");
    });

          // 12. --- Premium y publicidad ---
          async function checkPremiumStatus(uid) {
      const configRef = doc(db, "appConfig", "global");
          const configSnap = await getDoc(configRef);
          const userRef = doc(db, "users", uid);
          const userSnap = await getDoc(userRef);
          let isPremium = false;
          let showAds = true;
          if (userSnap.exists()) isPremium = userSnap.data().premium || false;
          if (configSnap.exists()) {
        const global = configSnap.data();
          const now = new Date();
          const endDate = new Date(global.premiumGlobalEndDate);
          if (global.isPremiumGlobalActive && now < endDate) {
            isPremium = true;
          showAds = global.isLaunchPromoActive;
        }
      }
          // Mostrar publicidad
          if (!isPremium) {
        const ad = document.createElement("div");
          ad.className = "notification is-warning has-text-centered";
          ad.innerHTML = "Publicidad: ¬°Explora nuestra versi√≥n Premium sin anuncios!";
          document.body.appendChild(ad);
      } else if (showAds) {
        const ad = document.createElement("div");
          ad.className = "has-text-centered has-text-grey-light";
          ad.innerHTML = "<small>Publicidad moderada activa por promoci√≥n.</small>";
          document.body.appendChild(ad);
      }
    }
    onAuthStateChanged(auth, async (user) => {
      if (user) await checkPremiumStatus(user.uid);
    });

    // 13. --- Panel admin premium ---
    document.getElementById("ff-set-premium-btn").addEventListener("click", async () => {
      const isActive = document.getElementById("ff-toggle-premium-global").checked;
          const endDate = document.getElementById("ff-premium-end-date").value;
          const setPremiumGlobal = httpsCallable(functions, "setPremiumGlobalStatus");
          try {
            await setPremiumGlobal({
              isPremiumGlobalActive: isActive,
              premiumGlobalEndDate: new Date(endDate).toISOString()
            });
          document.getElementById("ff-premium-status-text").textContent = `Premium Global actualizado hasta ${new Date(endDate).toLocaleString()}`;
        showToast("Actualizaci√≥n exitosa.", "is-success");
      } catch (error) {
        showToast("Error al actualizar estado global.", "is-danger");
      }
    });

    // 14. --- Validar rol admin al autenticar ---
    async function validarAdmin(uid) {
      const userRef = doc(db, "users", uid);
      const userSnap = await getDoc(userRef);
      if (userSnap.exists() && userSnap.data().role === "admin") {
        document.getElementById("ff-admin-view").classList.remove("is-hidden");
      }
    }
  </script>
</body>

</html>
