<!-- index.html: FeedFlow - Frontend para Brain-Storm (Firebase Config Real Integrado) -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FeedFlow - Brain Storm</title>
  <!-- Bulma CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #6a0dad, #00d4ff);
      color: #fff;
      min-height: 100vh;
    }
    .footer {
      font-size: 0.8rem;
      padding: 1rem;
      text-align: center;
      background-color: #f5f5f5;
      color: #222;
    }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <section class="hero is-bold is-primary">
    <div class="hero-body">
      <div class="container has-text-centered">
        <h1 class="title is-3 animate__animated animate__fadeInDown">Iniciar Sesión</h1>
      </div>
    </div>
  </section>

  <section id="auth-view" class="section animate__animated animate__fadeIn" style="max-width: 500px; margin: auto;">
    <div class="field">
      <button class="button is-danger is-fullwidth" id="google-login">
        <span class="icon"><i class="fab fa-google"></i></span>
        <span>Iniciar con Google</span>
      </button>
    </div>
    <div class="field">
      <label class="label">Correo electrónico</label>
      <div class="control has-icons-left">
        <input class="input" type="email" id="login-email" placeholder="Correo electrónico">
        <span class="icon is-small is-left"><i class="fas fa-envelope"></i></span>
      </div>
    </div>
    <div class="field">
      <label class="label">Contraseña</label>
      <div class="control has-icons-left">
        <input class="input" type="password" id="login-pass" placeholder="Contraseña">
        <span class="icon is-small is-left"><i class="fas fa-lock"></i></span>
      </div>
    </div>
    <div class="field is-grouped is-grouped-right">
      <p class="control">
        <button class="button is-success" id="email-login">Acceder</button>
      </p>
    </div>
    <p><a href="#" id="show-reset">¿Has olvidado tu contraseña?</a></p>
    <p class="mt-2">¿No tienes cuenta? <a href="#" id="show-register">Crear una cuenta</a></p>
  </section>

  <section id="config-view" class="section hidden">
    <div class="container">
      <h2 class="title is-4">Configuración de Ideas</h2>
      <div class="field">
        <label class="label">Palabra Clave</label>
        <div class="control">
          <input class="input" type="text" id="input-topic" placeholder="Ej. marketing emocional">
        </div>
      </div>
      <div class="field">
        <label class="label">Tipo de Copy</label>
        <div class="select">
          <select id="input-type">
            <option value="Informativo">Informativo</option>
            <option value="Emocional">Emocional</option>
            <option value="Técnico o profesional">Técnico o profesional</option>
          </select>
        </div>
      </div>
      <div class="field">
        <label class="label">Red Social</label>
        <div class="select">
          <select id="input-network">
            <option value="Facebook">Facebook</option>
          </select>
        </div>
      </div>
      <div class="field is-grouped is-grouped-right">
        <div class="control">
          <button class="button is-link" id="generate-ideas">✨ ¡Generar Ideas! ✨</button>
        </div>
      </div>
    </div>
  </section>

  <section id="results-view" class="section hidden">
    <div class="container">
      <h2 class="title is-4">Resultados</h2>
      <div id="results-content"></div>
      <button class="button is-light mt-4" id="back-button">Nueva Búsqueda</button>
    </div>
  </section>

  <footer class="footer">
    <p>Este contenido es generado por IA. El usuario es responsable de verificar su uso adecuado y legal.</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-functions.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCScJA-UGs3WcBnfAm-6K94ybZ4bzBahz8",
      authDomain: "brain-storm-8f0d8.firebaseapp.com",
      databaseURL: "https://brain-storm-8f0d8-default-rtdb.firebaseio.com",
      projectId: "brain-storm-8f0d8",
      storageBucket: "brain-storm-8f0d8.firebasestorage.app",
      messagingSenderId: "401208607043",
      appId: "1:401208607043:web:6f35fc81fdce7b3fbeaff6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const functions = getFunctions(app);

    const authView = document.getElementById("auth-view");
    const configView = document.getElementById("config-view");
    const resultsView = document.getElementById("results-view");
    const resultsContent = document.getElementById("results-content");

    onAuthStateChanged(auth, user => {
      if (user) {
        authView.classList.add("hidden");
        configView.classList.remove("hidden");
      } else {
        authView.classList.remove("hidden");
        configView.classList.add("hidden");
        resultsView.classList.add("hidden");
      }
    });

    document.getElementById("google-login").addEventListener("click", async () => {
      try {
        await signInWithPopup(auth, new GoogleAuthProvider());
      } catch (e) {
        alert("Error con Google: " + e.message);
      }
    });

    document.getElementById("email-login").addEventListener("click", async () => {
      const email = document.getElementById("login-email").value;
      const password = document.getElementById("login-pass").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (e) {
        alert("Error de inicio: " + e.message);
      }
    });

    document.getElementById("generate-ideas").addEventListener("click", async () => {
      const topic = document.getElementById("input-topic").value;
      const copyType = document.getElementById("input-type").value;
      const platform = document.getElementById("input-network").value;

      if (!topic || !copyType || !platform) return alert("Completa todos los campos.");

      const call = httpsCallable(functions, "generateIdeas");
      try {
        const res = await call({
          topic,
          copyType,
          socialMediaPlatforms: [platform],
          generationMode: "single-platform",
          language: "es",
          currentSessionId: "frontend-solo"
        });

        renderIdeas(res.data.ideas, res.data.finalPhrase);

      } catch (err) {
        alert("Error: " + err.message);
      }
    });

    document.getElementById("back-button").addEventListener("click", () => {
      resultsView.classList.add("hidden");
      configView.classList.remove("hidden");
    });

    function renderIdeas(ideasArray, finalPhrase) {
      resultsContent.innerHTML = "";
      ideasArray.forEach((idea, i) => {
        const box = document.createElement("div");
        box.className = "box";
        box.innerHTML = `
          <p><strong>✨ Idea ${i + 1}</strong></p>
          <p><strong>Gancho:</strong> ${idea.gancho}</p>
          <p><strong>Ángulo:</strong> ${idea.narrativa}</p>
          <p><strong>Post:</strong> ${idea.post}</p>
          <p><strong>Hashtags:</strong> ${idea.hashtags}</p>
          <p><strong>Visual:</strong> ${idea.visual}</p>
          <p><strong>CTA:</strong> ${idea.cta}</p>
        `;
        resultsContent.appendChild(box);
      });
      if (finalPhrase) {
        const phrase = document.createElement("blockquote");
        phrase.className = "mt-5 has-text-centered has-text-grey";
        phrase.textContent = finalPhrase;
        resultsContent.appendChild(phrase);
      }
      configView.classList.add("hidden");
      resultsView.classList.remove("hidden");
    }
  </script>
</body>
</html>
