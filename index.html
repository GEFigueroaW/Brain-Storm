<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FeedFlow</title>
  <!-- Bulma, Animate.css, Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { background: linear-gradient(135deg, #6a0dad, #f9d29d); font-family: 'Segoe UI', sans-serif; }
    .footer { font-size: 0.8rem; padding: 1rem; text-align: center; background-color: #f5f5f5; }
    .hidden { display: none !important; }
    .ad-banner { display: none; background: #fde68a; padding: 1rem; text-align: center; font-weight: bold; }
  </style>
</head>
<body>
  <section class="hero is-primary is-bold">
    <div class="hero-body">
      <div class="container has-text-centered">
        <img src="assets/logo.svg" alt="FeedFlow Logo" style="max-height: 80px;" />
        <h1 class="title">FeedFlow</h1>
        <p class="subtitle">Donde el scroll se convierte en arte ðŸŽ¨</p>
      </div>
    </div>
  </section>

  <!-- Vista de Login/Registro -->
  <section id="auth-view" class="section">
    <div class="container">
      <h2 class="title">Iniciar SesiÃ³n</h2>
      <div class="buttons">
        <button class="button is-danger" id="google-login"><i class="fab fa-google"></i> Iniciar con Google</button>
      </div>
      <div class="field">
        <label class="label">Correo electrÃ³nico</label>
        <div class="control has-icons-left">
          <input class="input" type="email" id="login-email" placeholder="ejemplo@correo.com">
          <span class="icon is-small is-left"><i class="fas fa-envelope"></i></span>
        </div>
      </div>
      <div class="field">
        <label class="label">ContraseÃ±a</label>
        <div class="control has-icons-left">
          <input class="input" type="password" id="login-pass" placeholder="********">
          <span class="icon is-small is-left"><i class="fas fa-lock"></i></span>
        </div>
      </div>
      <div class="field is-grouped">
        <div class="control">
          <button class="button is-primary" id="email-login">Acceder</button>
        </div>
        <div class="control">
          <a href="#" id="show-reset">Â¿Has olvidado tu contraseÃ±a?</a>
        </div>
      </div>
      <p class="mt-4">Â¿No tienes cuenta? <a href="#" id="show-register">Crear una cuenta</a></p>
    </div>
  </section>

  <!-- Vista ConfiguraciÃ³n -->
  <section id="config-view" class="section hidden">
    <div class="container">
      <h2 class="title">ConfiguraciÃ³n de Ideas</h2>
      <div class="field">
        <label class="label">Palabra Clave</label>
        <div class="control">
          <input class="input" type="text" id="input-topic" placeholder="Ej. ventas digitales">
        </div>
      </div>
      <div class="field">
        <label class="label">Tipo de Copy</label>
        <div class="select">
          <select id="input-type">
            <option value="Informativo">Informativo</option>
            <option value="Emocional">Emocional</option>
            <option value="TÃ©cnico o profesional">TÃ©cnico o profesional</option>
          </select>
        </div>
      </div>
      <div class="field">
        <label class="label">Red Social</label>
        <div class="select">
          <select id="input-network">
            <option value="Facebook">Facebook</option>
          </select>
        </div>
      </div>
      <div class="field is-grouped is-grouped-right">
        <div class="control">
          <button class="button is-link" id="generate-ideas">âœ¨ Â¡Generar Ideas! âœ¨</button>
        </div>
      </div>
      <p id="gen-count-info" class="has-text-grey mt-2 mb-4">Cargando contador...</p>
      <div class="ad-banner" id="ad-placeholder">Espacio para Anuncio</div>
    </div>
  </section>

  <!-- Vista Resultados -->
  <section id="results-view" class="section hidden">
    <div class="container">
      <h2 class="title">Resultados</h2>
      <div id="results-content"></div>
      <button class="button is-light mt-4" id="back-button">Nueva BÃºsqueda</button>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <p>Este contenido es generado por IA. El usuario es responsable de verificar su uso adecuado y legal.</p>
  </footer>
</body>
<!-- index.html - Parte 2: Firebase, lÃ³gica de autenticaciÃ³n y generaciÃ³n -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
  import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-functions.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCScJA-UGs3WcBnfAm-6K94ybZ4bzBahz8",
    authDomain: "brain-storm-8f0d8.firebaseapp.com",
    databaseURL: "https://brain-storm-8f0d8-default-rtdb.firebaseio.com",
    projectId: "brain-storm-8f0d8",
    storageBucket: "brain-storm-8f0d8.firebasestorage.app",
    messagingSenderId: "401208607043",
    appId: "1:401208607043:web:6f35fc81fdce7b3fbeaff6"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const functions = getFunctions(app);

  const authView = document.getElementById("auth-view");
  const configView = document.getElementById("config-view");
  const resultsView = document.getElementById("results-view");

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      authView.classList.add("hidden");
      configView.classList.remove("hidden");
      resultsView.classList.add("hidden");
      document.getElementById("gen-count-info").innerText = "Tienes 3 ideas disponibles esta semana."; // Placeholder
    } else {
      authView.classList.remove("hidden");
      configView.classList.add("hidden");
      resultsView.classList.add("hidden");
    }
  });

  document.getElementById("google-login").addEventListener("click", async () => {
    try {
      const provider = new GoogleAuthProvider();
      await signInWithPopup(auth, provider);
    } catch (e) {
      alert("Error con Google Sign-In: " + e.message);
    }
  });

  document.getElementById("email-login").addEventListener("click", async () => {
    const email = document.getElementById("login-email").value;
    const pass = document.getElementById("login-pass").value;
    try {
      await signInWithEmailAndPassword(auth, email, pass);
    } catch (e) {
      alert("Error al iniciar sesiÃ³n: " + e.message);
    }
  });

  document.getElementById("generate-ideas").addEventListener("click", async () => {
    const topic = document.getElementById("input-topic").value.trim();
    const type = document.getElementById("input-type").value;
    const network = document.getElementById("input-network").value;

    if (!topic || !type || !network) return alert("Completa todos los campos");

    const user = auth.currentUser;
    if (!user) return alert("No estÃ¡s autenticado");

    const generate = httpsCallable(functions, "generateIdeas");
    try {
      const res = await generate({ topic, copyType: type, socialMediaPlatforms: [network], generationMode: "single-platform", language: "es", currentSessionId: "browser-session-1" });
      configView.classList.add("hidden");
      resultsView.classList.remove("hidden");
      document.getElementById("results-content").innerText = res.data.ideas[0] || "Resultado generado";
    } catch (err) {
      alert("Error al generar idea: " + err.message);
    }
  });

  document.getElementById("back-button").addEventListener("click", () => {
    resultsView.classList.add("hidden");
    configView.classList.remove("hidden");
  });
</script>

</html>
